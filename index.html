<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="style.css">
    <title>Whatsapp</title>
</head>
<body>
    <div class="chatOptions" id="chatOptions">
        <!-- Lista de usuários será adicionada aqui dinamicamente -->
    </div>
    <div class="chatInterface">
        <div class="modal" id="usernameModal">
            <div class="conteudoModal">
                <h1>Bem-vindo ao Whatsapp!</h1>
                <h2>Digite seu nome de usuário</h2>
                <input type="text" id="nameInput" placeholder="Nome" required>
                <button id="setUsernameButton">Salvar</button>
            </div>
        </div>
        
        <div class="chatBox">
            <h2 id="chatUsername">Username</h2>
            <div class="areaMensagem" id="areaMensagem"></div>
            <div class="inputCaixa">
                <input type="text" id="msgInput" placeholder="Digite sua mensagem aqui" required>
                <button id="sendButton">Enviar</button>
            </div>
        </div>
    </div>
    <div class="sticker">
        <img src="imagens/chat.png">
        <span>Illustration by <a href="https://icons8.com/illustrations/author/zD2oqC8lLBBA">Icons 8</a> from <a href="https://icons8.com/illustrations">Ouch!</a></span>
    </div>
    <script>
        let socket;
        let username = '';
        let selectedUserId = '';

        function connectWebSocket() {
            socket = new WebSocket('ws://localhost:8765');

            socket.onopen = function () {
                console.log('Conectado ao servidor WebSocket');
            };

            socket.onmessage = function (event) {
                const message = JSON.parse(event.data);

                if (message.type === 'user_list') {
                    updateUserList(message.users);
                } else if (message.type === 'chat') {
                    const areaMensagem = document.getElementById('areaMensagem');
                    areaMensagem.innerHTML += `<div><strong>${message.sender}:</strong> ${message.text}</div>`;
                }
            };

            socket.onclose = function () {
                console.log('Desconectado do servidor WebSocket');
            };
        }

        function updateUserList(users) {
            const chatOptions = document.getElementById('chatOptions');
            chatOptions.innerHTML = '';  // Clear existing users

            users.forEach(userId => {
                const button = document.createElement('button');
                button.className = 'userOption';
                button.innerText = userId;
                button.addEventListener('click', function () {
                    selectedUserId = userId;
                    document.getElementById('chatUsername').innerText = selectedUserId;
                });
                chatOptions.appendChild(button);
            });
        }

        document.getElementById('setUsernameButton').addEventListener('click', function () {
            const nameInput = document.getElementById('nameInput');
            username = nameInput.value.trim();
            if (username) {
                document.getElementById('usernameModal').style.display = 'none';
                connectWebSocket();
            }
        });

        document.getElementById('sendButton').addEventListener('click', function () {
    if (selectedUserId && username) {
        const msgInput = document.getElementById('msgInput');
        const message = {
            type: 'chat',
            sender: username,
            recipient: selectedUserId,
            text: msgInput.value.trim()
        };
        socket.send(JSON.stringify(message));
        
        // Exibir a própria mensagem na área de mensagens
        //const areaMensagem = document.getElementById('areaMensagem');
        //areaMensagem.innerHTML += `<div><strong>Você:</strong> ${message.text}</div>`;
        
        msgInput.value = '';
    }
});


        window.onload = function() {
            document.getElementById('usernameModal').style.display = 'flex';
        }
    </script>
</body>
</html>
